# Fast Api디펜던시의 개념
- DI 처럼 작동.
- 디펜던시가 유용한 경우
    - 각 엔드포인트가 공유하는 기능
    - DB, 리소스 연결
    - 인증
    - 코드 중복 줄이기
- 코드 예시
```python
from fastapi import Depends
# Depends 에, 의존할 함수기능의 이름을 인자로 준다.
def get_item(headers = Depends(common_func)):
    return{
        'headers' : headers
    }
```
```python
# 각 엔드포인트에 붙어 동작할 함수이므로, 리퀘스트정도는 쓸수있다.
def convert_headers(request:Request):
    out_headers = []
    for key, value in request.headers.items():
        out_headers.append(f"{key} -- {value}")
    return out_headers
```
# 클래스 디펜던시
- FastApi 에서는 모든 Callable 은 디펜던시로 동작
- 따라서 클래스도 가능
```python
class Account:
    def __init__(self, name: str, email: str):
        self.name=name
        self.email=email
```
```python
@router.post('/user')
def create_user(name:str, email:str, password:str, account: Account = Depends()):
    # 해당 클래스의 인스턴스 생성시, name, email 등의 파라미터도 자동으로 넣어진다.
    # Account 클래스임을 클래스힌트로 알 수 있으므로, 알아서 해당 클래스에 종속되어 있음을 파악해서, 
    return{
        'name': account.name,
        'email': account.email,
    }
```
# 멀티레벨(Nested) 디펜던시
- 디펜던시 안의 디펜던시
```python
def convert_params(request:Request, separator: str):
    query = []
    for key, value in request.query_params.items():
        query.append(f"{key} {separator} {value}")
    return query
```
```python
def convert_headers(request: Request, separator: str = '--', query = Depends(convert_params)):
    out_headers = []
    for key,value in request.headers.items():
        out_headers.append(f"{key} {separotor} {value}")
    return {
        'headers' : out_headers,
        'query' : query,
    }
```
# 글로벌 디펜던시
- 모든 엔드포인트에 적용되는 디펜던시
- 모든 : router , app 둘 다 가능
- app 에 적용시 해당 앱의 모든 엔드포인트에 적용
- router 에 적용시 해당 라우터의 모든 엔드포인트에 적용

```python
from custom_log import log
# router 에 적용하는 예
router = APIRouter(
    prefix='/dependencies',
    tags=['dependencies'],
    dependencies=[Depends(log)]
)
```
```python
from fastapi import Request
def log(tag="",message="",request:Request=None):
    with open("log.txt", mode="a+") as log:
        log.write(f"{tag}: {message}\n")
        log.write(f"\t {request.url}: {message} \n")
```